#!/usr/bin/env bash
set -euo pipefail

case "${AGENT_ACTION:-}" in
  describe)
    echo "name: claude"
    echo "description: Claude Code CLI agent"
    echo "timeout: 600"
    echo "retries: 0"
    ;;
  execute)
    INPUT=$(cat)
    PROMPT=$(echo "$INPUT" | jq -r '.prompt')
    WORKDIR=$(echo "$INPUT" | jq -r '.workdir // "."')

    cd "$WORKDIR"
    claude --print --output-format text --max-turns 1 --message "$PROMPT"
    ;;
  *)
    echo "Unknown AGENT_ACTION: ${AGENT_ACTION:-<unset>}" >&2
    exit 1
    ;;
esac
